APP_NAME=logger

all: format build test

clean:
	@echo "----------------------------------------------------------"
	@echo "Cleaning"
	@echo "----------------------------------------------------------"
	@go clean
	@rm -f coverage.out
	@rm -fr bin
	@echo "-Done-----------------------------------------------------"


build: clean
	@echo "----------------------------------------------------------"
	@echo "Building '$(APP_NAME)' to bin"
	@echo "----------------------------------------------------------"
	@go build -o bin/$(APP_NAME)
	@echo "-Done-----------------------------------------------------"

format:
	@echo "----------------------------------------------------------"
	@echo "Formatting code"
	@echo "----------------------------------------------------------"
	@go fmt ./...
	@echo "-Done-----------------------------------------------------"

.PHONY: test
test:
	@echo "----------------------------------------------------------"
	@echo "Executing tests."
	@echo "----------------------------------------------------------"
	@go test -v -coverpkg $(shell go list ./... | egrep -v "test" | paste -sd "," -) ./... -coverprofile=coverage.out -covermode=atomic
	@echo "-Done-----------------------------------------------------"

